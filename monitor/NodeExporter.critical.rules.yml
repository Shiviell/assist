groups:

- name: NodeExporter.critical.rules

  rules:

  - alert: PrometheusTargetMissing

    expr: up{instance =~ ".*:9100"} == 0

    for: 1m

    labels:

      severity: "critical"

    annotations:

      summary: Prometheus target missing (instance {{ $labels.instance }})

      description: "A Prometheus target has disappeared. An exporter might be crashed.\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

  - alert: HostOutOfMemory

    expr: node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes * 100 < 5

    for: 5m

    labels:

      severity: "critical"

    annotations:

      summary: Host out of memory (instance {{ $labels.instance }})

      description: "Node memory is filling up (< 5% left)\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

  # Please add ignored mountpoints in node_exporter parameters like

  # "--collector.filesystem.ignored-mount-points=^/(sys|proc|dev|run)($|/)".

  # Same rule using "node_filesystem_free_bytes" will fire when disk fills for non-root users.

  - alert: HostOutOfDiskSpace

    expr: (node_filesystem_avail_bytes * 100) / node_filesystem_size_bytes < 5 and ON (instance, device, mountpoint) node_filesystem_readonly == 0

    for: 5m

    labels:

      severity: "critical"

    annotations:

      summary: Host out of disk space (instance {{ $labels.instance }})

      description: "Disk is almost full (< 5% left)\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

  - alert: HostHighCpuLoad

    expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 95

    for: 5m

    labels:

      severity: "critical"

    annotations:

      summary: Host high CPU load (instance {{ $labels.instance }})

      description: "CPU load is > 95%\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"

  - alert: HostSwapIsFillingUp

    expr: (1 - (node_memory_SwapFree_bytes / node_memory_SwapTotal_bytes)) * 100 > 80

    for: 5m

    labels:

      severity: "critical"

    annotations:

      summary: Host swap is filling up (instance {{ $labels.instance }})

      description: "Swap is filling up (>80%)\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"